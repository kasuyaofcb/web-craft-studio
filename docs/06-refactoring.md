# 6. リファクタリング

> **このフェーズで**: コードの可読性向上、重複コードの削減、パフォーマンスの改善を行います。

## 📌 リファクタリングの目的

- コードの可読性向上
- 重複コードの削減
- パフォーマンスの改善
- 保守性の向上

## 🔍 確認すべきポイント

### HTML

- [ ] セマンティックなタグが適切に使用されているか
- [ ] アクセシビリティが考慮されているか（`aria-label`など）
- [ ] 不要なネストがないか

### CSS/SCSS

- [ ] BEM命名規則に準拠しているか
- [ ] 重複するスタイルがないか
- [ ] ユーティリティクラスを適切に使用しているか
- [ ] 変数を使用して値が統一されているか

### JavaScript

- [ ] エラーハンドリングが適切に実装されているか
- [ ] 重複するコードがないか
- [ ] 関数が適切に分割されているか

### PHP

- [ ] エラーハンドリングが適切に実装されているか
- [ ] WordPress関数の戻り値をチェックしているか
- [ ] 重複するコードがないか
- [ ] 関数が適切に分割されているか

## 🛠️ リファクタリングの手順

1. **コードの確認**
   - 全体を確認して、改善点をリストアップ

2. **優先順位の決定**
   - 影響範囲が大きいものから順に対応

3. **段階的な改善**
   - 一度に全部を変更せず、段階的に改善

4. **動作確認**
   - 変更後は必ず動作確認を行う

## 📝 リファクタリングの手順

### 1. リファクタリング対象の特定

以下のポイントを確認します：

- [ ] 重複コードを特定
- [ ] エラーハンドリング不足を特定
- [ ] 命名規則の不統一を特定
- [ ] コードの可読性が低い箇所を特定

### 2. リファクタリング計画の作成

リファクタリング対象ごとにIssueを作成します。

**例**:
- `[リファクタリング] ヘッダーセクションのSCSS変数活用`
- `[リファクタリング] 重複CSSの統合`
- `[リファクタリング] PHP関数の分割`

### 3. リファクタリングの実施

1. **ブランチの作成**
   ```bash
   git checkout main
   git pull origin main
   git checkout -b issue-[Issue番号]-refactor-[対象]
   ```

2. **リファクタリング前の状態を確認**
   - 動作確認を実施
   - スクリーンショットを撮影（必要に応じて）

3. **リファクタリングの実施**
   - 小さな変更ごとに動作確認
   - 変更内容をメモ

4. **動作確認**
   - リファクタリング前と同じ動作になっているか確認

5. **コミット**
   ```bash
   git add .
   git commit -m "refactor: [対象] [変更内容]"
   ```

### リファクタリングの例

#### 例1: SCSS変数の活用

**Before**:
```scss
.indexFv {
  color: #333;
  font-size: 1.6rem;
}
```

**After**:
```scss
@use 'partials/variables';

.indexFv {
  color: variables.$color-text;
  font-size: variables.$font-size-base;
}
```

#### 例2: 重複CSSの統合

**Before**:
```scss
.indexServices__item {
  padding: 1rem;
  margin-bottom: 2rem;
}

.indexWorks__item {
  padding: 1rem;
  margin-bottom: 2rem;
}
```

**After**:
```scss
.indexServices__item,
.indexWorks__item {
  padding: 1rem;
  margin-bottom: 2rem;
}
```

## 📚 もっと詳しく知りたい場合

- [コーディング規約（詳細版）](coding-standards.md) - すべてのルール
- [よくある質問・トラブルシューティング](faq-troubleshooting.md) - 困ったときはここ

## ✅ 完了チェックリスト

- [ ] HTMLの構造が適切か
- [ ] CSS/SCSSが整理されているか
- [ ] JavaScriptが適切に実装されているか
- [ ] PHPが適切に実装されているか
- [ ] エラーハンドリングが適切か
- [ ] 動作確認が完了しているか

---

**お疲れ様でした！** これでプロジェクトの主要なフェーズは完了です。

---

**最終更新**: 2025/12/4
